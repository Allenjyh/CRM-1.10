<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title>时间选择，弹框选择</title>
		<meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1, user-scalable=no">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
        <link href="../../../home/phone/css/wechat_style.css" rel="stylesheet" />        
        <link href="../../../home/phone/css/fast_repairs.css" rel="stylesheet" />
        <link href="../../../home/phone/css/pickerStyle.css" rel="stylesheet"/>
	<script type="text/javascript" src="../../jquery-3.3.1.min.js"></script>
        <!-- <script src="home/phone/js/fast_repairs.js"></script> -->
		<style type="text/css">
			 .form_box4 li i {
                    font-size: 18px!important;
                    position: absolute;
                    background: rgba(255, 55, 88, 1);
                    color: #fff;
                    height: 24px;
                    min-width: 24px;
                    left: 58px;
                    top: -11px;
                    padding: 3px 6px;
                    line-height: 16px;
                    border-radius: 50%;
                }
             .form_box4 li {
                position: relative;
                /* float: left;
                margin-right: 30px;
                width: 80px;
                text-align: center; */
            }
            .index-nav li{
                width:50%;
                float: left;
                
            }
		</style>
	</head>

	<body>
        <!-- <input hidden id="repair_faults" value={防盗设施1,防盗设施2,防盗设施3,防盗设施4}> -->
        <div class="top_box ">
            <ul class="index-nav">
                <li class="Active"><a href="#"><span>快捷报修</span></a></li>
                <li ><a href="records.html"><span>报修记录</span></a></li>
            </ul>
        </div>
		<div class="addParkName-box" style="margin-bottom: 0px;">
			<div class=" addParkName-bar">
                    <span ><i style="color: #F52230;">* </i>报修类型</span>
                    <input type="text" id="pType" class="repairs_type com_type" readonly="readonly" placeholder="请选择">
					<b style="position: absolute;right: 0;top: 12px;color: rgba(0, 0, 0, 0.45)" ><i class="rep-arrow"></i> </b>
			</div>
		</div>
		<div class="addParkName-box" style="margin-bottom: 0px;">
			<div class=" addParkName-bar">
                    <span ><i style="color: #F52230;">* </i>报修类型</span>
                    <input type="text" id="repType" class="repairs_type com_type" readonly="readonly" placeholder="请选择">
					<b style="position: absolute;right: 0;top: 12px;color: rgba(0, 0, 0, 0.45)" ><i class="rep-arrow"></i> </b>
			</div>
		</div>
		<div class="addParkName-box" style="margin-top: 0px;margin-bottom: 0px;">
			<div class=" addParkName-bar">
					<span><i style="color: #F52230;">* </i>报修地址</span>
					<input id='repairs_address' type="text" class=" repairs_address" placeholder="请输入"readonly="readonly">		
			</div>
		</div>
		<div class="addParkName-box" style="margin-top: 0px;margin-bottom: 0px;">
            <div class=" addParkName-bar">
                    <span><i style="color: #F52230;">* </i>故障类型</span>
                    <!-- <input type="text" class="repairs_type" value="请选择" readonly="readonly"> -->
                    <input type="text" id="faultType" class="repairs_type fault_id" readonly="readonly" placeholder="请选择">
                    <b style="position: absolute;right: 0;top: 12px;color: rgba(0, 0, 0, 0.45)" ><i class="rep-arrow"></i> </b>
            </div>
        </div>
	    <div class="addParkName-box" style="margin-top: 0px;margin-bottom: 0px;">
            <div class=" addParkName-bar">
                    <span><i style="color: #F52230;">* </i>报修人</span>
                    <input id='repairs_address' type="text" class=" repairs_address" placeholder="请输入"readonly="readonly">		
            </div>
        </div>
        <div class="addParkName-box" style="margin-top: 0px;margin-bottom: 0px;">
            <div class=" addParkName-bar">
                    <span><i style="color: #F52230;">* </i>联系电话</span>
                    <input id='repairs_address' type="text" class=" repairs_address" placeholder="请输入"readonly="readonly">		
            </div>
        </div>
        <div class='divider'></div> 
        <div class="addParkName-box" style="margin-top: 0px;margin-bottom: 0px;">
            <div class=" addParkName-bar">
                    <span><i style="color: #F52230;">* </i> 1.1预约起始时间</span>
                    <input id='start_time' type="text" class=" repairs_address" placeholder="请选择"readonly="readonly">		
            </div>
        </div>
        <div class="addParkName-box" style="margin-top: 0px;margin-bottom: 0px;">
            <div class=" addParkName-bar">
                    <span><i style="color: #F52230;">* </i>1.4预约结束时间</span>
                    <input id='end_time' type="text" class=" repairs_address" placeholder="请选择"readonly="readonly">		
            </div>
        </div>
        <div class='divider'></div>
        
        <div class="form_box3" >
                <p >备注（100字以内）</p>
                <textarea name="" rows="" cols="" class="textArea" maxlength="100" placeholder="请输入" ></textarea>
        </div>
        <div class='divider'></div>
        <div class="form_box4 clear" >
                <p >图片</p>
                <!-- <ul class="clear">
            
                <img  src="/home/images/icon/Group1.png" onerror="this.src='/home/images/icon/Group1.png'">
            </li>
            <li><img src="/home/images/icon/ID_positive1.png"></li>
           
        </ul> -->
               <ul>
                   <li>
                        <input id="filesfz1" type="file" accept="image/*" name="" style="display: none;position: absolute;top: -9999px;">
                        <img id="shangchuan1" src="../../../home/phone/images/repair/shangchuan.png" alt="">
                        <span id="id_card_first" style="display:none;"></span>
                        <i>X</i>
                   </li>
                   <li>
                        <img src="../../../home/phone/images/repair/shangchuan.png" alt="">
                   </li>
                   <li>
                        <img src="../../../home/phone/images/repair/shangchuan.png" alt="">
                   </li>
                   <li>
                        <img src="../../../home/phone/images/repair/shangchuan.png" alt="">
                   </li>
                   <li>
                        <img src="../../../home/phone/images/repair/shangchuan.png" alt="">
                   </li>
                   <li>
                        <img src="../../../home/phone/images/repair/shangchuan.png" alt="">
                   </li>
               </ul>
        </div>

        <div class="addParkName-box" style="margin-bottom: 0px;">
                <div class=" addParkName-bar">
                        <span ><i style="color: #F52230;">* </i>1.2起租时间</span>
                        <input type="text" id="or_starDate" class="repairs_type com_type" readonly="readonly" placeholder="请选择">
                        <b style="position: absolute;right: 0;top: 12px;color: rgba(0, 0, 0, 0.45)" ><i class="rep-arrow"></i> </b>
                </div>
        </div>
        <div class="addParkName-box" style="margin-bottom: 0px;">
                <div class=" addParkName-bar">
                       
                    <p style="height: 50px;">
                            <!-- <a href="/searchLeaseOrders/{{$park_id}}/{{$type}}"><span> <img src="/wechat/images/enter/label7.png" alt=""></span></!--> 
                                <span class="select" style="font-size:16px;">1.3时间筛选</span>
                    </p>
                </div>
        </div>
        <div class="addParkName-box" style="margin-bottom: 0px;">
                <div class=" addParkName-bar">
                        <span ><i style="color: #F52230;">* </i>2.1租金单提醒日</span>
                        <input type="text" id="billRemind" class="repairs_type com_type" readonly="readonly" placeholder="请选择">
                        <b style="position: absolute;right: 0;top: 12px;color: rgba(0, 0, 0, 0.45)" ><i class="rep-arrow"></i> </b>
                </div>
        </div>
        <div class="addParkName-box" style="margin-bottom: 0px;">
                <div class=" addParkName-bar">
                        <span ><i style="color: #F52230;">* </i>2.2租赁期限</span>
                        <input type="text" id="timeLimitbtn" class="repairs_type com_type" readonly="readonly" placeholder="请选择">
                        <b style="position: absolute;right: 0;top: 12px;color: rgba(0, 0, 0, 0.45)" ><i class="rep-arrow"></i> </b>
                </div>
        </div>
        <div class="addParkName-box" style="margin-bottom: 0px;">
                <div class=" addParkName-bar">
                        <span ><i style="color: #F52230;">* </i>2.3交租期</span>
                        <input type="text" id="TheLeaseBtn" class="repairs_type com_type" readonly="readonly" placeholder="请选择">
                        <b style="position: absolute;right: 0;top: 12px;color: rgba(0, 0, 0, 0.45)" ><i class="rep-arrow"></i> </b>
                </div>
        </div>
       


        <div class='divider'></div>
         <div id=" fast_repairs_btn" class="submit_btn fast_repairs_btn">提交</div>
         




    <!--选择报修类型START-->
    <div id="room-controller" class="room-controller" style="display: none;">
        <div class="room-controller-all">
            <div class="select-room-btnbox" style="border-bottom: 1px solid #ebebeb;">
                <table>
                    <tr>
                        <td id="roomClose" style="color: #A7A7A7;">取消</td>
                        <td id="repTitle">报修类型</td>
                        <td id="roomSure" style="color: #1A8CFF;">确定</td>
                    </tr>
                </table>
            </div>
            <div class="select-cross"></div>
            <div class="room-controller-content">
                <div class="room-package-top border-bottom"></div>
                <div class="room-package-bottom border-top"></div>
                <div class="room-package" id="boxId">
                    <!--<div class="room">
                        <ul class="room-list">
                        </ul>
                    </div>-->
                </div>
            </div>
            <div class="room-controller-bottom"></div>
        </div>
    </div>
    <!--选择报修类型END-->

    </body>
    <!-- 1.1与 1.2,1.3 加载的 timePicker.js 不同 -->
    <!-- 两个文件不能同时加载 timePicker.js -->
    <!--1.1预约开始，结束时间选择(只能填未来时间，最早是当天)   -->
    <!-- <script src="js/timePicker.js"></script> -->
    <!--1.2时间 1.3时间筛选：起租期开始时间(只能填以前，最晚是当天)-->
    <!-- <script src="timePicker23.js"></script> -->
    <!-- 1.3时间筛选：起租期开始时间(只能填以前，最晚是当天)-->
    <script src="js/yizuSilding.js"></script>
    <!--1.4 预约开始，   年，时间 分钟   -->
    <script src="js/timePicker4.js"></script>
    <script src="picker.js"></script><!--所有内容都是同一个js报修类型，故障类型-->
	<script>

//1.2时间：起租期开始时间(只能填以前，最晚是当天) //1.3.yizuSilding.js  时间筛选 
// 2.内容 2.1租金单提醒日(每月15-28日提醒) //2.2租赁期限 (6个月-19年11月)//2.3交租期 (每月1日- 10日)

//  A 1.1  1.4 预约开始，结束时间选择(只能填未来时间，最早是当天)
    picker(["#start_time", "#end_time"], function () {
        var start_time = $('#start_time').val();//开始时间1
        start_time = Date.parse(new Date(start_time)) / 1000;
        var end_time = $('#end_time').val();//结束时间1
        end_time = Date.parse(new Date(end_time)) / 1000;
        if (start_time >= end_time) {
            alert("结束时间应大于开始时间");
            $('#end_time').val('');
            return false;
        }
    });



        //1.2起租期开始时间
        function starDate(timeStr){
                function add0(m){return m<10?'0'+m:m }
                var time = new Date(parseInt(timeStr) * 1000);
                var y = time.getFullYear();
                var m = time.getMonth()+1;
                var d = time.getDate();
                return y+'.'+add0(m)+'.'+add0(d+1);
            }

          
            // picker(["#or_starDate"],function(a){

            //     if($("#or_starDate").attr("data-id") != ""){
            //         var oldstarTime = starDate($("#or_starDate").attr("data-id")).split(".");
            //         var newstarTime = ($("#or_starDate").val()).split("-");
            //         if( parseInt(oldstarTime[0]) == parseInt(newstarTime[0]) &&
            //             parseInt(oldstarTime[1]) == parseInt(newstarTime[1]) &&
            //             parseInt(oldstarTime[2]) > parseInt(newstarTime[2])){
            //                 alerts._show("输入起租日期选择有误")
            //             $("#or_starDate").val(starDate($("#or_starDate").attr("data-id")));
            //         }
            //     }

            // },1);

            //续租时间
            if($("#or_starDate").val() != ""){
                $("#or_starDate").val(starDate($("#or_starDate").val()));
            }
    //1.2起租期结束

    // 1.3.yizuSilding.js  时间筛选
        // 时间筛选 
            yizuSide({ele:".select",width:"287"},function(startime,endtime,fn){
                _start_time = startime.split(".");
                _endtime = endtime.split(".");
                var star, end; 
                var u = navigator.userAgent, app = navigator.appVersion;
                        var isiOS = !!u.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/); //ios终端
                        if (isiOS) {
                            star = (new Date(_start_time[0]+"-"+_start_time[1]+"-"+_start_time[2]+"T00:00:00")).getTime() / 1000 ; //开始时间
                            end = (new Date( _endtime[0]+"-"+ _endtime[1]+"-"+ _endtime[2]+"T00:00:00")).getTime() / 1000 ; //结束开始时间
                        }else{
                            star  = new Date(startime).getTime() / 1000 ; //开始时间
                            end  = new Date(endtime).getTime() / 1000 ; //结束开始时间
                        }
                if(star > end){
                    alert("开始时间不能大于结束时间",function(){
                        $("#ending-time").val();
                    })
                    return;
                }
                fn();
                let _star =star - 28800;
                let _end =end +57599;
                // if(_star && _end)
                // getAjax("",0,0,_type,park_id,_star,_end)
            });
            
            // //1.3时间数据
            // picker(["#starting-time","#ending-time"],function(a){
            
            // },4)
       //1.3.yizuSilding.js  时间筛选结束  
       
       

//1.2时间：起租期开始时间(只能填以前，最晚是当天) //1.3.yizuSilding.js  时间筛选 
// 2.内容   2.1租金单提醒日(每月15-28日提醒) //2.2租赁期限 (6个月-19年11月)//2.3交租期 (每月1日- 10日) //2.4.报修类型 //2.5.故障类型
//  B 内容筛选判定
    var repTypes = {
        levelItem: [//1.报修类型
            {id:1,name:"公共报修"},
            {id:2,name:"公司报修"}
        ]
    },
    faultTypes = {//2.故障类型
        levelItem: []
    };

    // var repair_faults = $("#repair_faults").val() ? JSON.parse($("#repair_faults").val()) : [];
    // repair_faults.forEach(function(index){
        //     faultTypes.levelItem.push({id:index.fault_id,name: eval("'" + index."fault_name" + "'") })
        // });
    var repair_faults = [{"fault_id":1,"fault_name":"防盗设施1"},{"fault_id":2,"fault_name":"防盗设施2"},{"fault_id":3,"fault_name":"防盗设施3"},{"fault_id":4,"fault_name":"防盗设施4"}];
    // console.log(repair_faults)
repair_faults.forEach(function(index){
    faultTypes.levelItem.push({id:index.fault_id,name: eval("'" + index.fault_name + "'") })
});

//2.4.报修类型
$("#repType").on("click",function(){
    $('body').css('overflow','hidden');//浮层出现时窗口不能滚动设置
    $("#repTitle").text("报修类型");
    document.getElementById("room-controller").style.display = "block";
    var repTypePicker = new roomPicker({
        data:repTypes,
        id:"boxId"
    });
    repTypePicker.init("repType",function(){
        if($("#repTitle").text() == "报修类型"){
            document.getElementById("repType").value = getRoomItem.level1.name;
            document.getElementById("repType").dataset.id = getRoomItem.level1.id;
            $('body').css('overflow','auto');// 浮层关闭时滚动设置
        }
    })
})
//2.5.故障类型
$("#faultType").on("click",function(){
    $('body').css('overflow','hidden');//浮层出现时窗口不能滚动设置
    $("#repTitle").text("故障类型");
    document.getElementById("room-controller").style.display = "block";
    var repTypePicker = new roomPicker({
        data:faultTypes,
        id:"boxId"
    });
    repTypePicker.init("faultType",function(){
        if($("#repTitle").text() == "故障类型"){
            document.getElementById("faultType").value = getRoomItem.level1.name;
            document.getElementById("faultType").dataset.id = getRoomItem.level1.id;
            $('body').css('overflow','auto');// 浮层关闭时滚动设置
        }
    })
})


            //计算当前月份有多少天

            function getNowFormatDate() {
                var date = new Date();
                var seperator1 = "-";
                var year = date.getFullYear();
                var month = date.getMonth() + 1;
                var strDate = date.getDate();
                if (month >= 1 && month <= 9) {
                    month = "0" + month;
                }
                if (strDate >= 0 && strDate <= 9) {
                    strDate = "0" + strDate;
                }
                var currentdate = year + seperator1 + month + seperator1 + strDate;
                return currentdate;
            }
            function getMonthLength() {

                var d = new Date(getNowFormatDate())
                // 将日期设置为下月一号
                d.setMonth(d.getMonth()+1)
                d.setDate('1')
                // 获取本月最后一天
                d.setDate(d.getDate()-1)
                return d.getDate()
            }

            //2.2租赁期限 6个月-19年11月
            var MonthArry = [],
                yearArry = [],
                fristMonthArry = [];
            for(var y=0;y<=19;y++){
                //半期起租
                if(y>=6 && y<=11){
                    fristMonthArry.push({id:y,name:y+"个月"})
                }
                if(y <= 11){
                    MonthArry.push({id:y,name:y+"个月"})
                }
                if(y == 0){
                    yearArry.push({id:y,name:y+"年",children:fristMonthArry})
                }else {
                    yearArry.push({id:y,name:y+"年",children:MonthArry})
                }

            }
            //2.2租赁期限 6个月-19年11月
            var TimeLimit = {
                    levelItem: yearArry
                },
                TheLease = {//2.1选择租金单提醒日
                    levelItem: [
                        {id:0,name:"每月",children:[
                                {id:"01,01",name:"1日"},
                                {id:"01,02",name:"1日-2日"},
                                {id:"01,03",name:"1日-3日"},
                                {id:"01,04",name:"1日-4日"},
                                {id:"01,05",name:"1日-5日"},
                                {id:"01,06",name:"1日-6日"},
                                {id:"01,07",name:"1日-7日"},
                                {id:"01,08",name:"1日-8日"},
                                {id:"01,09",name:"1日-9日"},
                                {id:"01,10",name:"1日-10日"},
                            ]}
                    ]
                },
                billRemind = {//2.1选择租金单提醒日 
                    levelItem: []
                };

            for(var i = 15;i<=28;i++){
                //每月15日提醒
                billRemind.levelItem.push({
                    id:i,
                    name:"每月"+i+"日提醒",
                })
            }

                //2.1选择租金单提醒日  每月15-28日提醒
            document.querySelector("#billRemind").addEventListener("click",function(){
                document.getElementById("room-controller").style.display = "block";
                document.body.style.overflow = 'hidden';//浮层出现时窗口不能滚动设置
                document.querySelector("#repTitle").textContent = "租金单提醒日";
                var billRemindPicker = new roomPicker({
                    data:billRemind,
                    id:"boxId"
                });
                billRemindPicker.init("billRemind",function(){
                    if(document.querySelector("#repTitle").textContent == "租金单提醒日"){
                        document.getElementById("billRemind").value = getRoomItem.level1.name;
                        document.getElementById("billRemind").dataset.value = getRoomItem.level1.id;
                        document.body.style.overflow = 'auto';// 浮层关闭时滚动设置
                    }
                })

            },false)

            //2.2租赁期限
            document.querySelector("#timeLimitbtn").addEventListener("click",function(){

                document.getElementById("room-controller").style.display = "block";
                document.body.style.overflow = 'hidden';//浮层出现时窗口不能滚动设置
                document.querySelector("#repTitle").textContent = "租赁期限";
                var repTypePicker = new roomPicker({
                    data:TimeLimit,
                    id:"boxId"
                });
                repTypePicker.init("timeLimitbtn",function(){
                    console.log(getRoomItem)
                    if(document.querySelector("#repTitle").textContent == "租赁期限"){
                        document.getElementById("timeLimitbtn").value = ( parseInt(getRoomItem.level1.name) == 0 ?"":getRoomItem.level1.name) + ( parseInt(getRoomItem.level2.name) == 0 ?"":getRoomItem.level2.name);
                        document.getElementById("timeLimitbtn").dataset.value = getRoomItem.level1.id*12 + getRoomItem.level2.id;
                        document.body.style.overflow = 'auto'; // 浮层关闭时滚动设置
                    }
                })
            },false)

            //2.3交租期
            document.querySelector("#TheLeaseBtn").addEventListener("click",function(){
                document.getElementById("room-controller").style.display = "block";
                document.body.style.overflow = 'hidden';//浮层出现时窗口不能滚动设置
                document.querySelector("#repTitle").textContent = "交租期";
                var repTypePicker = new roomPicker({
                    data:TheLease,
                    id:"boxId"
                });
                repTypePicker.init("TheLeaseBtn",function(){
                    if(document.querySelector("#repTitle").textContent == "交租期"){
                        document.getElementById("TheLeaseBtn").value = getRoomItem.level1.name + getRoomItem.level2.name;
                        document.getElementById("TheLeaseBtn").dataset.value = "0000,00,"+getRoomItem.level2.id;
                        document.body.style.overflow = 'auto';// 浮层关闭时滚动设置
                    }
                })
            },false);




   




$(".rep-close").on("click",function(){
    $(this).parent().parent().remove();
})
	</script>
</html>